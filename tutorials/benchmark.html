<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html"><link rel="next" title="Reference" href="../reference/index.html"><link rel="prev" title="Custom System" href="custom_system.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>How to Benchmark Different Python Implementations with pytest-benchmark - Infrastructure Systems Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Infrastructure Systems Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <span class="sidebar-brand-text">Infrastructure Systems Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../how_tos/index.html">How Tos</a><input aria-label="Toggle navigation of How Tos" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../how_tos/list_time_series.html">How to list existing time series data</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Tutorials</a><input aria-label="Toggle navigation of Tutorials" checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="custom_system.html">Custom System</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">How to Benchmark Different Python Implementations with <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">How to Benchmark Different Python Implementations with <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code>.</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">Reference</a><input aria-label="Toggle navigation of Reference" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/api/index.html">API</a><input aria-label="Toggle navigation of API" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/api/system.html">System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/api/components.html">Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/api/time_series.html">Time Series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/api/location.html">Location</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/api/quantities.html">Quantities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/api/function_data.html">Function data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/system_json.html">Viewing System Data in JSON Format</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../explanation/index.html">Explanation</a><input aria-label="Toggle navigation of Explanation" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../explanation/system.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/components.html">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/time_series.html">Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/location.html">Location</a></li>
<li class="toctree-l2"><a class="reference internal" href="../explanation/serialization.html">Serialization</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/tutorials/benchmark.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="how-to-benchmark-different-python-implementations-with-pytest-benchmark">
<h1>How to Benchmark Different Python Implementations with <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code><a class="headerlink" href="#how-to-benchmark-different-python-implementations-with-pytest-benchmark" title="Link to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Most of this text was generated with AI.</p>
</div>
<p>This guide will walk you through setting up and running performance benchmarks
using <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code>. Benchmarking is crucial for making informed decisions
about which libraries or implementation strategies offer the best performance
for your specific use cases. We’ll use the common example of comparing two JSON
serialization libraries: the standard <code class="docutils literal notranslate"><span class="pre">json</span></code> and the faster <code class="docutils literal notranslate"><span class="pre">orjson</span></code>.</p>
<section id="why-benchmark">
<h2>Why benchmark?<a class="headerlink" href="#why-benchmark" title="Link to this heading">¶</a></h2>
<p>When you have multiple ways to achieve the same task (e.g., using different
libraries or algorithms), benchmarks provide quantitative data on their
performance. This data helps you:</p>
<ul class="simple">
<li><p>Identify performance bottlenecks.</p></li>
<li><p>Choose the most efficient library/method for critical code paths.</p></li>
<li><p>Track performance regressions or improvements over time.</p></li>
<li><p>Justify technical decisions with concrete evidence.</p></li>
</ul>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h2>
<p>Before you start, make sure you have the following installed in your Python environment:</p>
<ol class="arabic simple">
<li><p><strong>Python</strong>: (e.g., Python 3.8+)</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">uv</span></code></strong>: Or your preferred Python package manager/runner.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">pytest</span></code></strong>: The testing framework.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code></strong>: The pytest plugin for benchmarking.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">orjson</span></code></strong>: The alternative JSON library we’ll be testing against (the
standard <code class="docutils literal notranslate"><span class="pre">json</span></code> library is built-in).</p></li>
</ol>
<p>You can install the necessary Python packages using <code class="docutils literal notranslate"><span class="pre">uv</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uv pip install pytest pytest-benchmark orjson</span>
</pre></div>
</div>
</section>
</section>
<section id="id1">
<h1>How to Benchmark Different Python Implementations with <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code>.<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<p>This guide will walk you through setting up and running performance benchmarks
using <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code>. Benchmarking is crucial for making informed decisions
about which libraries or implementation strategies offer the best performance
for your specific use cases. We’ll use the common example of comparing two JSON
serialization libraries: the standard <code class="docutils literal notranslate"><span class="pre">json</span></code> and the faster <code class="docutils literal notranslate"><span class="pre">orjson</span></code>.</p>
<section id="id2">
<h2>Why Benchmark?<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>When you have multiple ways to achieve the same task (e.g., using different
libraries or algorithms), benchmarks provide quantitative data on their
performance. This data helps you:</p>
<ul class="simple">
<li><p>Identify performance bottlenecks.</p></li>
<li><p>Choose the most efficient library/method for critical code paths.</p></li>
<li><p>Track performance regressions or improvements over time.</p></li>
<li><p>Justify technical decisions with concrete evidence.</p></li>
</ul>
</section>
<section id="id3">
<h2>Prerequisites<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>Before you start, make sure you have the following installed in your Python environment:</p>
<ol class="arabic simple">
<li><p><strong>Python</strong>: (e.g., Python 3.8+)</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">uv</span></code></strong>: Or your preferred Python package manager/runner.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">pytest</span></code></strong>: The testing framework.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code></strong>: The pytest plugin for benchmarking.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">orjson</span></code></strong>: The alternative JSON library we’ll be testing against (the
standard <code class="docutils literal notranslate"><span class="pre">json</span></code> library is built-in).</p></li>
</ol>
<p>You can install the necessary Python packages using <code class="docutils literal notranslate"><span class="pre">uv</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uv pip install pytest pytest-benchmark orjson</span>
</pre></div>
</div>
</section>
<section id="setting-up-your-benchmark-file">
<h2>Setting up Your Benchmark File<a class="headerlink" href="#setting-up-your-benchmark-file" title="Link to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Create a directory for your benchmark scripts. Following your project
structure, let’s assume this is a <code class="docutils literal notranslate"><span class="pre">scripts/</span></code> directory.</p></li>
<li><p>Inside the <code class="docutils literal notranslate"><span class="pre">scripts/</span></code> directory, create a new Python file for your
benchmarks. For our JSON example, let’s name it <code class="docutils literal notranslate"><span class="pre">test_json_performance.py</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>project_root/
└── scripts/
    └── test_json_performance.py
</pre></div>
</div>
</li>
</ol>
</section>
<section id="writing-benchmark-functions">
<h2>Writing Benchmark Functions<a class="headerlink" href="#writing-benchmark-functions" title="Link to this heading">¶</a></h2>
<p>In your <code class="docutils literal notranslate"><span class="pre">test_json_performance.py</span></code> file, you’ll write functions that
<code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code> can discover and run. Each function will test a specific
piece of code.</p>
<p>Here’s how to structure the benchmark for comparing <code class="docutils literal notranslate"><span class="pre">json.dumps</span></code> and <code class="docutils literal notranslate"><span class="pre">orjson.dumps</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># scripts/test_json_performance.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">orjson</span>

<span class="c1"># Sample data to be used for serialization</span>
<span class="n">SAMPLE_DATA</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Example User&quot;</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s2">&quot;is_active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;balance&quot;</span><span class="p">:</span> <span class="mf">1234.56</span><span class="p">,</span>
    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="s2">&quot;value&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)},</span>
<span class="p">}</span>

<span class="c1"># Benchmark for the standard json library&#39;s dumps function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">benchmark_standard_json_dumps</span><span class="p">(</span><span class="n">benchmark</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Benchmarks the standard json.dumps() function.&quot;&quot;&quot;</span>
    <span class="n">benchmark</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">,</span> <span class="n">SAMPLE_DATA</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">benchmark_orjson_dumps</span><span class="p">(</span><span class="n">benchmark</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Benchmarks the orjson.dumps() function.&quot;&quot;&quot;</span>
    <span class="n">benchmark</span><span class="p">(</span><span class="n">orjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">,</span> <span class="n">SAMPLE_DATA</span><span class="p">)</span>


<span class="n">SERIALIZED_JSON_STD</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">SAMPLE_DATA</span><span class="p">)</span>
<span class="n">SERIALIZED_JSON_ORJSON</span> <span class="o">=</span> <span class="n">orjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">SAMPLE_DATA</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">benchmark_standard_json_loads</span><span class="p">(</span><span class="n">benchmark</span><span class="p">):</span>
    <span class="n">benchmark</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">SERIALIZED_JSON_STD</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">benchmark_orjson_loads</span><span class="p">(</span><span class="n">benchmark</span><span class="p">):</span>
    <span class="n">benchmark</span><span class="p">(</span><span class="n">orjson</span><span class="o">.</span><span class="n">loads</span><span class="p">,</span> <span class="n">SERIALIZED_JSON_ORJSON</span><span class="p">)</span>

</pre></div>
</div>
<p><strong>Key points in the code:</strong></p>
<ul class="simple">
<li><p>We import <code class="docutils literal notranslate"><span class="pre">pytest</span></code> and the libraries we want to test (<code class="docutils literal notranslate"><span class="pre">json</span></code>, <code class="docutils literal notranslate"><span class="pre">orjson</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SAMPLE_DATA</span></code> provides a consistent input for all benchmarks.</p></li>
<li><p>Each function starting with <code class="docutils literal notranslate"><span class="pre">benchmark_</span></code> is recognized by <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">benchmark</span></code> fixture (provided by <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code>) is passed as an argument to these functions.</p></li>
<li><p>You call <code class="docutils literal notranslate"><span class="pre">benchmark(function_to_test,</span> <span class="pre">arg1,</span> <span class="pre">arg2,</span> <span class="pre">...)</span></code> to run and measure
the <code class="docutils literal notranslate"><span class="pre">function_to_test</span></code> with its arguments.</p></li>
</ul>
</section>
<section id="running-the-benchmarks">
<h2>Running the Benchmarks<a class="headerlink" href="#running-the-benchmarks" title="Link to this heading">¶</a></h2>
<p>To run your benchmarks, navigate to your project’s root directory in the
terminal and use the command structure you’ve established:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uv run pytest scripts/test_json_performance.py</span>
</pre></div>
</div>
<p>If you have multiple benchmark files in the <code class="docutils literal notranslate"><span class="pre">scripts/</span></code> directory, you can run one by one.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">uv run pytest scripts/{BENCHMARK}.py</span>
</pre></div>
</div>
</section>
<section id="understanding-the-output">
<h2>Understanding the output<a class="headerlink" href="#understanding-the-output" title="Link to this heading">¶</a></h2>
<p>After running, <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code> will produce a table summarizing the
performance results. It will look something like this (the exact numbers will
vary based on your machine):</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name (time in us)</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Max</p></th>
<th class="head"><p>Mean</p></th>
<th class="head"><p>StdDev</p></th>
<th class="head"><p>Median</p></th>
<th class="head"><p>IQR</p></th>
<th class="head"><p>Outliers(*)</p></th>
<th class="head"><p>Rounds</p></th>
<th class="head"><p>Iterations</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>benchmark_orjson_dumps</p></td>
<td><p>3.8530 (1.0)</p></td>
<td><p>6.5290 (1.0)</p></td>
<td><p>4.3386 (1.0)</p></td>
<td><p>0.3104 (1.0)</p></td>
<td><p>4.2600 (1.0)</p></td>
<td><p>0.3045 (1.0)</p></td>
<td><p>64;95</p></td>
<td><p>22893</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>benchmark_standard_json_dumps</p></td>
<td><p>19.0930 (4.96)</p></td>
<td><p>31.2950 (4.80)</p></td>
<td><p>20.6635 (4.76)</p></td>
<td><p>1.6072 (5.18)</p></td>
<td><p>20.2170 (4.75)</p></td>
<td><p>1.4480 (4.75)</p></td>
<td><p>72;165</p></td>
<td><p>4633</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>benchmark_orjson_loads</p></td>
<td><p>3.3270 (1.0)</p></td>
<td><p>5.8330 (1.0)</p></td>
<td><p>3.6799 (1.0)</p></td>
<td><p>0.3019 (1.0)</p></td>
<td><p>3.6020 (1.0)</p></td>
<td><p>0.2660 (1.0)</p></td>
<td><p>101;111</p></td>
<td><p>26329</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>benchmark_standard_json_loads</p></td>
<td><p>6.8310 (2.05)</p></td>
<td><p>11.2870 (1.94)</p></td>
<td><p>7.5088 (2.04)</p></td>
<td><p>0.7889 (2.61)</p></td>
<td><p>7.2790 (2.02)</p></td>
<td><p>0.6900 (2.59)</p></td>
<td><p>84;116</p></td>
<td><p>12691</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Key columns to look at:</strong></p>
<ul class="simple">
<li><p><strong>Name:</strong> The name of your benchmark function.</p></li>
<li><p><strong>Min, Max, Mean, Median:</strong> These are timings (often in microseconds, <code class="docutils literal notranslate"><span class="pre">us</span></code>,
or milliseconds, <code class="docutils literal notranslate"><span class="pre">ms</span></code>). <strong>Lower values are better.</strong> The <code class="docutils literal notranslate"><span class="pre">Mean</span></code> or <code class="docutils literal notranslate"><span class="pre">Median</span></code> are
often good general indicators.</p></li>
<li><p><strong>StdDev:</strong> Standard deviation, showing the variability of the measurements.
Lower is generally better, indicating more consistent performance.</p></li>
<li><p><strong>Rounds:</strong> How many times the core benchmark loop was run by
<code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code> to gather statistics.</p></li>
<li><p><strong>Iterations:</strong> How many times your target function was called within each
round.</p></li>
<li><p><strong>Ops/s (or Rounds/s):</strong> Operations per second. <strong>Higher values are better.</strong>
(This column might not always be present by default or may be named differently
based on configuration, but “Min”, “Mean”, “Median” time are primary).</p></li>
</ul>
<p>The numbers in parentheses (e.g., <code class="docutils literal notranslate"><span class="pre">(1.0)</span></code>, <code class="docutils literal notranslate"><span class="pre">(4.96)</span></code>) next to the metrics for
<code class="docutils literal notranslate"><span class="pre">benchmark_orjson_dumps</span></code> show its performance relative to the baseline (the
fastest test, which is itself in this case). For
<code class="docutils literal notranslate"><span class="pre">benchmark_standard_json_dumps</span></code>, <code class="docutils literal notranslate"><span class="pre">(4.96)</span></code> next to its <code class="docutils literal notranslate"><span class="pre">Min</span></code> time means it was
4.96 times slower than the <code class="docutils literal notranslate"><span class="pre">Min</span></code> time of the fastest test
(<code class="docutils literal notranslate"><span class="pre">benchmark_orjson_dumps</span></code>).</p>
<p>From the example output, you could conclude that <code class="docutils literal notranslate"><span class="pre">orjson</span></code> is significantly
faster than the standard <code class="docutils literal notranslate"><span class="pre">json</span></code> for both <code class="docutils literal notranslate"><span class="pre">dumps</span></code> and <code class="docutils literal notranslate"><span class="pre">loads</span></code> operations on this
particular <code class="docutils literal notranslate"><span class="pre">SAMPLE_DATA</span></code> and machine.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../reference/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="custom_system.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Custom System</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, NREL
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">How to Benchmark Different Python Implementations with <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code></a><ul>
<li><a class="reference internal" href="#why-benchmark">Why benchmark?</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">How to Benchmark Different Python Implementations with <code class="docutils literal notranslate"><span class="pre">pytest-benchmark</span></code>.</a><ul>
<li><a class="reference internal" href="#id2">Why Benchmark?</a></li>
<li><a class="reference internal" href="#id3">Prerequisites</a></li>
<li><a class="reference internal" href="#setting-up-your-benchmark-file">Setting up Your Benchmark File</a></li>
<li><a class="reference internal" href="#writing-benchmark-functions">Writing Benchmark Functions</a></li>
<li><a class="reference internal" href="#running-the-benchmarks">Running the Benchmarks</a></li>
<li><a class="reference internal" href="#understanding-the-output">Understanding the output</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=38b66d78"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=3a0c56fd"></script>
    </body>
</html>